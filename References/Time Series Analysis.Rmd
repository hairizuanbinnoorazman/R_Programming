---
title: "Time Series Analysis"
output: html_document
---

## Introduction

Time series analysis can be done with native R objects such as vector, matrix and data.frame objects. However, in some cases, the information in those native object may contain all the functionality required to do a full analysis on a time series dataset

```{r}
#install.packages("zoo")
library(zoo)

# Getting the data to play around with zoo package
# install.packages("quantmod")
library(quantmod)
library(dplyr)
chartSeries(AAPL)
timeData <- data.frame(AAPL)
timeData <- mutate(timeData, Date = row.names(timeData))
timeData <- select(timeData, Date, AAPL.Close)

# Passing the data to zoo
aapl <- read.zoo(timeData)
```

## Understanding what is within the aapl zoo dataset

```{r}
plot(aapl, main = "Apple Closing Prices on NASDAQ", ylab = "Prices (USD)", xlab = "Date")

# Get the data point where aapl was the maximum
aapl[which.max(aapl)]

# Get the data point where aapl was the minimum
aapl[which.min(aapl)]

ret_simple <- diff(aapl) / lag(aapl, k = -1) * 100
ret_count <- diff(log(aapl)) * 100

# coredata strips of all "time" attributes within the xts dataset
summary(coredata(ret_simple))

quantile(ret_simple, probs = 0.01)

# Histogram of returns
hist(ret_simple, breaks = 100, main = "Histogram of Simple Returns", xlab = "%")
```

With the above graph, we can somewhat say that there is a roughly an equal chance of gaining/losing when buying this stock (in simple man terms). The returns roughly follow a normal distributions that is centered around the 0 mark.

## Restricting the analysis to a shorter time frame

```{r}
aapl_2013 <- window(aapl, start = "2013-01-01", end = "2013-12-31")
aapl_2013[which.max(aapl_2013)]
```

## Modelling time series data

```{r}
data <- read.zoo("../Data/UKHP.csv", sep = ",", header = TRUE, format = "%Y-%m", FUN = as.yearmon)

# Function frequency returns the time period - quarterly would be 4 and monthly would be 12
frequency(data)

# Calculate simple returns
hp_ret <- diff(data) / lag(data, k = - 1) * 100
hist(hp_ret, breaks = 100, main = "Histogram of Simple Returns", xlab = "%")
```

We would be using the ARIMA (Autoregressive Integrated Moving Average) time series models. This model is based on the assumption that the current value can only depend on past values of the time series or past values of error terms from the past.

We would use the auto.arima function provided in the forecast package to identify the optimal model and estimate the coefficients

```{r}
mod <- auto.arima(data, stationary = TRUE, seasonal = FALSE, ic = "aic")
# Restricted to stationary models
# Restricted to non-seasonal models
# Quality of model calculated with the Akaike Information Critera

mod
```
